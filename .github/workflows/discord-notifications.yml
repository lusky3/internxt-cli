name: Discord Notifications

on:
  pull_request:
    types: [opened, closed, reopened]
  issues:
    types: [opened, closed, reopened]
  release:
    types: [published]
  workflow_run:
    workflows: ["Check for new internxt-cli release and build Docker image"]
    types: [completed]

permissions:
  contents: read

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: PR Notification
        if: github.event_name == 'pull_request'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "Pull Request ${{ github.event.action }}"
          description: |
            **${{ github.event.pull_request.title }}**
            by @${{ github.event.pull_request.user.login }}
          url: ${{ github.event.pull_request.html_url }}
          color: >-
            ${{
              github.event.action == 'closed' && github.event.pull_request.merged && '0x00ff00' ||
              github.event.action == 'opened' && '0x0099ff' ||
              '0xffaa00'
            }}

      - name: Issue Notification
        if: github.event_name == 'issues'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "Issue ${{ github.event.action }}"
          description: |
            **${{ github.event.issue.title }}**
            by @${{ github.event.issue.user.login }}
          url: ${{ github.event.issue.html_url }}
          color: ${{ github.event.action == 'closed' && '0x00ff00' || '0xff0000' }}

      - name: Release Notification
        if: github.event_name == 'release'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "üöÄ New Release: ${{ github.event.release.tag_name }}"
          description: |
            ${{ github.event.release.name }}

            [View Release](${{ github.event.release.html_url }})
          color: 0x00ff00

      - name: Workflow Failure Notification
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "‚ùå Workflow Failed: ${{ github.event.workflow_run.name }}"
          description: |
            Branch: `${{ github.event.workflow_run.head_branch }}`
            [View Run](${{ github.event.workflow_run.html_url }})
          color: 0xff0000

      - name: New Version Build Notification
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.name == 'Check for new internxt-cli release and build Docker image'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "‚úÖ New Internxt CLI Version Built"
          description: |
            Successfully built and published new Docker image
            [View Run](${{ github.event.workflow_run.html_url }})
          color: 0x00ff00
